# syntax=docker/dockerfile:1.7
ARG BASE_IMAGE=playpalace/base:latest
FROM ${BASE_IMAGE}

ENV DISPLAY=:0
ARG APP_USER=playpalace
ENV APP_USER=${APP_USER}
ARG APP_DIR=/app/client

# hadolint ignore=DL3008
RUN apt-get update \
    && apt-get install -y --no-install-recommends \
       libgtk-3-dev \
       libglu1-mesa \
       libnss3 \
       libtiff5 \
       libsm6 \
       libxrender1 \
       libxext6 \
       libxcomposite1 \
       libxdamage1 \
       libxrandr2 \
       libxkbcommon0 \
       libxtst6 \
       libpulse0 \
       libasound2 \
    && rm -rf /var/lib/apt/lists/*

WORKDIR ${APP_DIR}

COPY . ./
RUN uv sync --frozen --no-dev --python python3.11 \
    && chown -R ${APP_USER}:${APP_USER} ${APP_DIR}
USER ${APP_USER}

ENV VIRTUAL_ENV=${APP_DIR}/.venv
ENV PATH="$VIRTUAL_ENV/bin:$PATH"

CMD ["python", "client.py"]
