<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PlayPalace Web Client</title>
    <style>
      :root {
        --bg: #f5f7fb;
        --panel: #ffffff;
        --text: #1f2937;
        --muted: #6b7280;
        --border: #d1d5db;
        --primary: #005b99;
        --danger: #a61b1b;
      }
      * { box-sizing: border-box; }
      body {
        margin: 0;
        font-family: "Segoe UI", Tahoma, sans-serif;
        color: var(--text);
        background: radial-gradient(circle at top left, #ffffff, var(--bg));
      }
      h1, h2 {
        margin: 0;
      }
      main {
        max-width: 1100px;
        margin: 0 auto;
        padding: 16px;
        display: grid;
        gap: 12px;
      }
      .panel {
        background: var(--panel);
        border: 1px solid var(--border);
        border-radius: 10px;
        padding: 12px;
      }
      .row { display: flex; gap: 8px; align-items: center; flex-wrap: wrap; }
      .volume-controls {
        margin-top: 8px;
      }
      .volume-controls label {
        display: flex;
        align-items: center;
        gap: 6px;
      }
      .volume-controls input[type="range"] {
        width: 160px;
      }
      input, select, button, textarea {
        font: inherit;
        padding: 8px;
        border: 1px solid var(--border);
        border-radius: 6px;
      }
      button {
        background: var(--primary);
        color: #fff;
        border: none;
        cursor: pointer;
      }
      button.secondary { background: #4b5563; }
      button:disabled { opacity: 0.55; cursor: not-allowed; }
      .status { color: var(--muted); }
      .status.error { color: var(--danger); }
      .grid {
        display: grid;
        grid-template-columns: minmax(260px, 0.8fr) minmax(520px, 1.9fr);
        gap: 12px;
      }
      .menu-list {
        list-style: none;
        margin: 0;
        padding: 0;
        border: 1px solid var(--border);
        border-radius: 8px;
        max-height: 440px;
        overflow-y: auto;
      }
      .menu-item {
        width: 100%;
        padding: 8px;
        text-align: left;
        border-radius: 0;
        background: #fff;
        color: var(--text);
        border-bottom: 1px solid var(--border);
        cursor: default;
      }
      .menu-item:last-child { border-bottom: 0; }
      .menu-item.active {
        background: #e5f1fb;
        outline: 2px solid #93c5fd;
      }
      .menu-item-touch {
        width: 100%;
        min-height: 44px;
        padding: 8px;
        text-align: left;
        border: 0;
        border-radius: 0;
        background: transparent;
        color: var(--text);
      }
      .history {
        border: 1px solid var(--border);
        border-radius: 8px;
        min-height: 480px;
        height: 62vh;
        overflow-y: auto;
        padding: 8px;
        background: #fbfdff;
        white-space: pre-wrap;
        resize: none;
      }
      .history-entry { margin: 0 0 6px; }
      .history-log {
        border: 1px solid var(--border);
        border-radius: 8px;
        min-height: 480px;
        height: 62vh;
        overflow-y: auto;
        padding: 8px;
        background: #fbfdff;
      }
      .history-line {
        margin: 0 0 6px 0;
        white-space: pre-wrap;
      }
      .history-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
      }
      .history-toggle-title {
        background: transparent;
        border: 0;
        color: var(--text);
        padding: 0;
        font-size: inherit;
        font-weight: inherit;
        cursor: default;
      }
      .actions-btn {
        margin-left: 8px;
      }
      .actions-list {
        list-style: none;
        margin: 8px 0 0 0;
        padding: 0;
        border: 1px solid var(--border);
        border-radius: 8px;
        max-height: 40vh;
        overflow-y: auto;
      }
      .actions-item-btn {
        width: 100%;
        text-align: left;
        border: 0;
        border-radius: 0;
        border-bottom: 1px solid var(--border);
        background: transparent;
        color: var(--text);
        min-height: 44px;
      }
      .actions-list li:last-child .actions-item-btn {
        border-bottom: 0;
      }
      dialog {
        border: 1px solid var(--border);
        border-radius: 10px;
        width: min(420px, 92vw);
      }
      .sr-only {
        position: absolute;
        width: 1px;
        height: 1px;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        border: 0;
      }
      .footer {
        text-align: right;
      }
      #login-dialog input,
      #login-dialog button {
        min-height: 44px;
      }
      @media (max-width: 900px) {
        .grid { grid-template-columns: 1fr; }
        .history {
          display: none;
        }
        .history-log {
          display: block;
          min-height: 300px;
          height: 42vh;
        }
        .history-toggle-title {
          cursor: pointer;
          text-decoration: underline;
        }
      }
    </style>
  </head>
  <body>
    <main>
      <h1>PlayPalace V11 Web</h1>

      <section class="panel">
        <div class="row">
          <button id="open-login-btn" type="button" class="secondary" tabindex="-1">Login/Reconnect</button>
          <button id="disconnect-btn" type="button" class="secondary" tabindex="-1">Disconnect</button>
          <span id="status" class="status" role="text">Disconnected</span>
        </div>
        <div class="row volume-controls">
          <label for="audio-mute">
            Mute
            <input id="audio-mute" type="checkbox" />
          </label>
          <label for="music-volume">
            Music
            <input id="music-volume" type="range" min="0" max="100" step="10" value="20" />
            <span id="music-volume-value" class="status">20%</span>
          </label>
          <label for="ambience-volume">
            Ambience
            <input id="ambience-volume" type="range" min="0" max="100" step="10" value="100" />
            <span id="ambience-volume-value" class="status">100%</span>
          </label>
        </div>
      </section>

      <section id="game-shell" class="grid" hidden>
        <section class="panel">
          <div class="row">
            <h2>Game</h2>
            <button id="actions-btn" class="secondary actions-btn" type="button" tabindex="-1">Actions</button>
          </div>
          <ul id="menu-list" class="menu-list" tabindex="0"></ul>
          <section id="inline-input" class="panel" hidden style="margin-top: 8px;">
            <p id="inline-input-prompt" style="margin: 0 0 6px 0;"></p>
            <div class="row">
              <input id="inline-input-value" type="text" style="flex: 1;" />
              <button id="inline-input-submit" type="button" tabindex="-1">Submit</button>
              <button id="inline-input-cancel" type="button" class="secondary" tabindex="-1">Cancel</button>
            </div>
          </section>
        </section>

        <section class="panel">
          <div class="history-header">
            <h2><button id="history-toggle" class="history-toggle-title" type="button" tabindex="-1" aria-expanded="true">History</button></h2>
          </div>
          <div id="history-content">
            <textarea id="history" class="history" readonly tabindex="0" aria-label="History"></textarea>
            <div
              id="history-log"
              class="history-log"
              tabindex="0"
              aria-label="History"
              hidden
            ></div>
          </div>

          <h2 style="margin-top: 10px;">Chat</h2>
          <form id="chat-form" class="row" style="margin-top: 10px;">
            <label>
              Chat
              <input id="chat-input" type="text" placeholder="Type message. Prefix with . for global." size="32" aria-label="Chat" />
            </label>
            <button type="submit" tabindex="-1">Send</button>
          </form>
        </section>
      </section>

      <dialog id="input-dialog">
        <form method="dialog" id="input-dialog-form">
          <p id="input-prompt"></p>
          <input id="input-value" type="text" style="width: 100%;" />
          <div class="row" style="justify-content: flex-end; margin-top: 10px;">
            <button value="cancel" type="button" id="input-cancel" class="secondary">Cancel</button>
            <button value="submit" type="submit" id="input-submit">Submit</button>
          </div>
        </form>
      </dialog>

      <dialog id="actions-dialog">
        <div id="actions-dialog-form">
          <p><strong>Actions</strong></p>
          <ul id="actions-list" class="actions-list"></ul>
          <div class="row" style="justify-content: flex-end; margin-top: 10px;">
            <button value="cancel" type="button" id="actions-cancel" class="secondary">Close</button>
          </div>
        </div>
      </dialog>

      <dialog id="login-dialog">
        <form id="connect-form" method="dialog">
          <p><strong>Connect to PlayPalace</strong></p>
          <p id="login-error" class="status error" hidden></p>
          <div style="display: grid; gap: 8px;">
            <label>
              Username
              <input
                id="username"
                type="text"
                required
                autocomplete="username"
                autocapitalize="none"
                autocorrect="off"
                spellcheck="false"
                enterkeyhint="next"
              />
            </label>
            <label>
              Password
              <input
                id="password"
                type="password"
                required
                autocomplete="current-password"
                autocapitalize="none"
                autocorrect="off"
                spellcheck="false"
                enterkeyhint="go"
              />
            </label>
            <label>
              <input id="remember-me" type="checkbox" />
              Remember username
            </label>
          </div>
          <div class="row" style="justify-content: flex-end; margin-top: 10px;">
            <button id="connect-btn" type="submit">Connect</button>
          </div>
        </form>
      </dialog>

      <div id="live-polite" class="sr-only" aria-live="polite" aria-atomic="true"></div>
      <div id="live-assertive" class="sr-only" aria-live="assertive" aria-atomic="true"></div>

      <footer class="panel footer">
        <small id="app-version" role="text">Version</small>
      </footer>
    </main>

    <script>
      (() => {
        const cacheBust = `cb=${Date.now()}`;

        function loadScript(src, { type = "text/javascript", optional = false } = {}) {
          return new Promise((resolve, reject) => {
            const script = document.createElement("script");
            if (type === "module") {
              script.type = "module";
            }
            script.src = src;
            script.onload = () => resolve();
            script.onerror = () => {
              if (optional) {
                resolve();
              } else {
                reject(new Error(`Failed to load script: ${src}`));
              }
            };
            document.body.appendChild(script);
          });
        }

        (async () => {
          await loadScript(`./version.js?${cacheBust}`, { optional: true });
          await loadScript(`./config.sample.js?${cacheBust}`, { optional: true });
          await loadScript(`./config.js?${cacheBust}`, { optional: true });

          const version = String(window.PLAYPALACE_WEB_VERSION || "2026.02.08.1").trim();
          await loadScript(`./app.js?v=${encodeURIComponent(version)}&${cacheBust}`, {
            type: "module",
          });
        })().catch((error) => {
          // Keep failures visible for deployment debugging.
          console.error(error);
        });
      })();
    </script>
  </body>
</html>
